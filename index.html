<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grove Steet Gang</title>
    <link rel="icon" type="image/png" href="grove.png">

    <style>
        :root {
            --bg-gradient: linear-gradient(135deg, #0a0e27 0%, #1e1e3f 50%, #2d1b69 100%);
            --glass-bg: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.2);
            --primary: #6366f1;
            --secondary: #8b5cf6;
            --tertiary: #06b6d4;
            --success: #10b981;
            --error: #ef4444;
            --text-primary: #ffffff;
            --text-secondary: rgba(255, 255, 255, 0.7);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: var(--bg-gradient);
            min-height: 100vh;
            padding: 20px;
            color: var(--text-primary);
            overflow-x: hidden;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: var(--text-primary);
            margin-bottom: 50px;
            animation: fadeInDown 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .header h1 {
            font-size: 3rem;
            margin-bottom: 15px;
            font-weight: 800;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 50%, var(--tertiary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 0 40px rgba(99, 102, 241, 0.5);
        }

        .header p {
            font-size: 1.2rem;
            color: var(--text-secondary);
            font-weight: 300;
        }

        .statistics-container {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 40px;
            max-width: 1200px;
            margin-left: auto;
            margin-right: auto;
        }

        @media (max-width: 768px) {
            .statistics-container {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 480px) {
            .statistics-container {
                grid-template-columns: 1fr;
            }
        }

        .stat-card {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            padding: 24px 20px;
            box-shadow: 0 8px 32px rgba(99, 102, 241, 0.2);
            text-align: center;
            animation: slideUp 0.6s cubic-bezier(0.4, 0, 0.2, 1) forwards;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            flex-direction: column;
            justify-content: center;
            min-height: 140px;
        }

        .stat-card:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 12px 40px rgba(99, 102, 241, 0.4);
            border-color: var(--primary);
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 8px;
            background: linear-gradient(135deg, var(--primary), var(--tertiary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: countUp 1s ease-out;
        }

        .stat-number.success {
            background: linear-gradient(135deg, var(--success), #34d399);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .stat-number.danger {
            background: linear-gradient(135deg, var(--error), #f87171);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .stat-number.primary {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .stat-label {
            font-size: 0.85rem;
            color: var(--text-secondary);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Линейный прогресс-бар */
        .progress-bar-container {
            width: 100%;
            margin-top: 12px;
        }

        .progress-bar-wrapper {
            width: 100%;
            height: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.2);
            position: relative;
        }

        .progress-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #10b981 0%, #06b6d4 100%);
            border-radius: 10px;
            transition: width 1.5s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 0 10px rgba(16, 185, 129, 0.6);
        }

        .progress-percentage {
            font-size: 1.8rem;
            font-weight: 800;
            color: var(--text-primary);
            margin-bottom: 8px;
            background: linear-gradient(135deg, #10b981, #06b6d4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        @keyframes countUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Фильтры с Glassmorphism */
        .filters-container {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 40px;
            box-shadow: 0 8px 32px rgba(99, 102, 241, 0.2);
            animation: slideUp 0.5s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }

        .filter-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            flex-wrap: wrap;
            align-items: center;
        }

        .filter-group {
            flex: 1;
            min-width: 200px;
        }

        .filter-label {
            display: block;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 10px;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .filter-select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid rgba(255, 255, 255, 0.15);
            border-radius: 12px;
            font-size: 1rem;
            background: rgba(255, 255, 255, 0.05);
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .filter-select:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.3);
        }

        .filter-select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.3);
            background: rgba(255, 255, 255, 0.1);
        }

        .filter-select option {
            background: #1e1e3f;
            color: var(--text-primary);
        }

        .controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .refresh-btn {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: var(--text-primary);
            border: none;
            padding: 14px 32px;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 8px 24px rgba(99, 102, 241, 0.4);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            gap: 10px;
            position: relative;
            overflow: hidden;
        }

        .refresh-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.5s;
        }

        .refresh-btn:hover::before {
            left: 100%;
        }

        .refresh-btn:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 12px 32px rgba(99, 102, 241, 0.6);
        }

        .refresh-btn:active {
            transform: translateY(-1px) scale(1);
        }

        .refresh-btn.loading {
            opacity: 0.7;
            cursor: not-allowed;
        }

        .stats {
            background: rgba(255,255,255,0.2);
            padding: 12px 24px;
            border-radius: 25px;
            color: white;
            font-weight: 600;
            backdrop-filter: blur(10px);
        }

        .loading-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 400px;
            color: var(--text-primary);
            font-size: 1.2rem;
            font-weight: 600;
        }

        .spinner {
            width: 70px;
            height: 70px;
            border: 6px solid rgba(255,255,255,0.2);
            border-top-color: var(--primary);
            border-right-color: var(--secondary);
            border-bottom-color: var(--tertiary);
            border-radius: 50%;
            animation: spin 1s ease-in-out infinite;
            margin-bottom: 25px;
            box-shadow: 0 0 30px rgba(99, 102, 241, 0.5);
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .error-container {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 2px solid var(--glass-border);
            padding: 50px;
            border-radius: 24px;
            text-align: center;
            box-shadow: 0 25px 60px rgba(0,0,0,0.4);
            max-width: 550px;
            margin: 60px auto;
        }

        .error-container h2 {
            color: var(--error);
            margin-bottom: 20px;
            font-size: 2rem;
            font-weight: 800;
        }

        .error-container p {
            color: var(--text-secondary);
            margin-bottom: 30px;
            font-size: 1.1rem;
        }

        .retry-btn {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: var(--text-primary);
            border: none;
            padding: 14px 36px;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 8px 24px rgba(99, 102, 241, 0.4);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .retry-btn:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 12px 32px rgba(99, 102, 241, 0.6);
        }

        .retry-btn:active {
            transform: translateY(-1px) scale(1.02);
        }

        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
            gap: 30px;
            margin-top: 30px;
        }

        .card {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 28px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            opacity: 0;
            animation: slideUp 0.6s cubic-bezier(0.4, 0, 0.2, 1) forwards;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border-radius: 20px;
            padding: 2px;
            background: linear-gradient(135deg, transparent, transparent);
            -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor;
            mask-composite: exclude;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .card.passed {
            border-left: 4px solid var(--success);
        }

        .card.passed::before {
            background: linear-gradient(135deg, var(--success), #34d399);
        }

        .card.failed {
            border-left: 4px solid var(--error);
        }

        .card.failed::before {
            background: linear-gradient(135deg, var(--error), #f87171);
        }

        .card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 20px 50px rgba(99, 102, 241, 0.4);
        }

        .card:hover::before {
            opacity: 1;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(40px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .card-header {
            border-bottom: 2px solid #f0f0f0;
            padding-bottom: 15px;
            margin-bottom: 15px;
        }

        .card-title {
            font-size: 1.4rem;
            color: var(--text-primary);
            font-weight: 700;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .exam-type-badge {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 12px;
            font-size: 0.85rem;
            font-weight: 600;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: var(--text-primary);
            margin-bottom: 12px;
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.4);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .result-badge {
            display: inline-flex;
            align-items: center;
            padding: 8px 16px;
            border-radius: 12px;
            font-size: 0.9rem;
            font-weight: 700;
            gap: 6px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .result-badge.pass {
            background: rgba(16, 185, 129, 0.2);
            color: var(--success);
            border: 2px solid var(--success);
        }

        .result-badge.fail {
            background: rgba(239, 68, 68, 0.2);
            color: var(--error);
            border: 2px solid var(--error);
        }

        .card-subtitle {
            font-size: 0.95rem;
            color: var(--text-secondary);
            font-weight: 400;
        }

        .card-body {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1000;
            animation: fadeIn 0.3s ease;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-backdrop {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .modal-content {
            position: relative;
            background: var(--glass-bg);
            backdrop-filter: blur(30px);
            -webkit-backdrop-filter: blur(30px);
            border: 2px solid var(--glass-border);
            border-radius: 24px;
            max-width: 900px;
            width: 90%;
            max-height: 85vh;
            overflow-y: auto;
            box-shadow: 0 25px 60px rgba(0, 0, 0, 0.5), 0 0 100px rgba(99, 102, 241, 0.3);
            animation: modalSlideIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            padding: 0;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: scale(0.9) translateY(30px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-header {
            padding: 32px 36px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.2), rgba(139, 92, 246, 0.2));
            position: sticky;
            top: 0;
            z-index: 10;
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
        }

        .modal-close {
            position: absolute;
            top: 24px;
            right: 24px;
            width: 40px;
            height: 40px;
            background: rgba(239, 68, 68, 0.2);
            border: 2px solid var(--error);
            border-radius: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: var(--error);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-weight: bold;
        }

        .modal-close:hover {
            background: var(--error);
            color: white;
            transform: rotate(90deg) scale(1.1);
        }

        .modal-title {
            font-size: 2rem;
            font-weight: 800;
            color: var(--text-primary);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .modal-subtitle {
            font-size: 1.1rem;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 8px;
        }

        .modal-body {
            padding: 32px 36px;
        }

        .modal-info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 32px;
        }

        .modal-info-item {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 16px;
        }

        .modal-info-label {
            font-size: 0.85rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .modal-info-value {
            font-size: 1.1rem;
            color: var(--text-primary);
            font-weight: 600;
        }

        .answers-section {
            margin-top: 24px;
        }

        .answers-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .answer-item {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-left: 4px solid var(--primary);
            padding: 16px 20px;
            border-radius: 12px;
            margin-bottom: 12px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .answer-item:hover {
            background: rgba(255, 255, 255, 0.08);
            border-left-color: var(--tertiary);
            transform: translateX(4px);
        }

        .answer-label {
            font-weight: 700;
            color: var(--primary);
            font-size: 0.9rem;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .answer-value {
            color: var(--text-primary);
            font-size: 1rem;
            line-height: 1.6;
        }

        .card-field {
            display: flex;
            justify-content: space-between;
            align-items: start;
            padding: 10px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .card-field:last-child {
            border-bottom: none;
        }

        .field-label {
            font-weight: 600;
            color: var(--text-secondary);
            margin-right: 12px;
            flex-shrink: 0;
            text-transform: uppercase;
            font-size: 0.85rem;
            letter-spacing: 0.5px;
        }

        .field-value {
            color: var(--text-primary);
            text-align: right;
            word-break: break-word;
            font-weight: 500;
        }



        .month-divider {
            background: var(--glass-bg);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            padding: 20px 30px;
            border-radius: 16px;
            color: var(--text-primary);
            font-weight: 700;
            font-size: 1.4rem;
            margin: 40px 0 30px 0;
            text-align: center;
            border: 1px solid var(--glass-border);
            box-shadow: 0 8px 24px rgba(99, 102, 241, 0.2);
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        @media (max-width: 768px) {
            body {
                padding: 15px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .header p {
                font-size: 1rem;
            }

            .cards-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .controls {
                flex-direction: column;
                align-items: stretch;
            }

            .refresh-btn,
            .stats {
                width: 100%;
                justify-content: center;
            }

            .filter-row {
                flex-direction: column;
            }

            .filter-group {
                width: 100%;
            }

            .stat-number {
                font-size: 2.2rem;
            }

            .card {
                padding: 20px;
            }

            .card-title {
                font-size: 1.2rem;
            }

            .modal-content {
                width: 95%;
                max-height: 90vh;
                border-radius: 20px;
            }

            .modal-header,
            .modal-body {
                padding: 24px;
            }

            .modal-title {
                font-size: 1.5rem;
            }

            .modal-close {
                width: 36px;
                height: 36px;
                font-size: 20px;
            }
        }

        @media (min-width: 769px) and (max-width: 1024px) {
            .cards-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .card:nth-child(1) { animation-delay: 0.1s; }
        .card:nth-child(2) { animation-delay: 0.2s; }
        .card:nth-child(3) { animation-delay: 0.3s; }
        .card:nth-child(4) { animation-delay: 0.4s; }
        .card:nth-child(5) { animation-delay: 0.5s; }
        .card:nth-child(6) { animation-delay: 0.6s; }
        .card:nth-child(7) { animation-delay: 0.7s; }
        .card:nth-child(8) { animation-delay: 0.8s; }
        .card:nth-child(9) { animation-delay: 0.9s; }

        .no-data {
            text-align: center;
            color: var(--text-primary);
            font-size: 1.3rem;
            padding: 80px 30px;
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            font-weight: 600;
        }

        .modal-content::-webkit-scrollbar {
            width: 10px;
        }

        .modal-content::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        }

        .modal-content::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 10px;
        }

        .modal-content::-webkit-scrollbar-thumb:hover {
            background: var(--secondary);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Экзамены Grove Steet</h1>
            <p>Статистика и ответы на экзамены</p>
        </div>

        <div id="statisticsContainer" class="statistics-container" style="display: none;">
        </div>

        <div class="filters-container" id="filtersContainer" style="display: none;">
            <div class="filter-row">
                <div class="filter-group">
                    <label class="filter-label" for="examTypeFilter">📝 Тип экзамена:</label>
                    <select class="filter-select" id="examTypeFilter" onchange="applyFilters()">
                        <option value="all">Все экзамены</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label class="filter-label" for="monthFilter">📅 Месяц:</label>
                    <select class="filter-select" id="monthFilter" onchange="applyFilters()">
                        <option value="all">Все месяцы</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label class="filter-label" for="statusFilter">🎯 Статус:</label>
                    <select class="filter-select" id="statusFilter" onchange="applyFilters()">
                        <option value="all">Все</option>
                        <option value="passed">Сдавшие</option>
                        <option value="failed">Не сдавшие</option>
                    </select>
                </div>
                <div class="filter-group">
                    <button class="refresh-btn" id="refreshBtn" onclick="loadData()" style="margin-top: 24px; width: 100%;">
                        <span>🔄</span>
                        <span>Обновить данные</span>
                    </button>
                </div>
            </div>
        </div>

        <div id="content">
        </div>
    </div>

    <script>
        const API_URL = 'https://script.googleusercontent.com/macros/echo?user_content_key=AehSKLj2NQM6zC4T5iRTFqF7w8nC5l6N5zpZfQh97WSOcf2TvoeJhM6tJIqpuGKzk_xiTrNtU0anYfXqoU30njgrYg7ltc62W-fnwrrH1eTaPBqA9dazTWWU5bTwzLl4J_cDXdKqkd0eyclMHusEei4ekneNKFQrlCVJ4shMDrmzVl6pH4iAAht6wq-sovTM4OqvXuKhybSTonQiKnvCNxtI7-e-H0gX-q3pHp8WZKl0700IoPJDiXZT1V142-rJ87rkcsNOkH5aWWgjLMtPzZWWZOms-RwYM_G48V_aKjWN&lib=MHWFXZt9OZWlcv2PWzngd7CL2PWyMTp-G';
        
        let allData = [];
        let filteredData = [];
        
        const EXAM_QUESTIONS = {
            'Вступительный экзамен Плэйя': {
                fields: ['F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z', 'AA', 'AB', 'AC', 'AD', 'AE', 'AF', 'AG', 'AH', 'AI', 'AJ', 'AK', 'AL', 'AM', 'AN', 'AO'],
                labels: [
                    'Что запрещено делать на складе?',
                    'Норма патронов и металла?',
                    'Наказание за воровство со склада?',
                    'Наказание за игнорирование старшего состава?',
                    'Что будет за нарушение правил?',
                    'Наказание за агрессию к своим?',
                    'Что делать при указании старшего?',
                    'Действия при наведении оружия?',
                    'Разрешенное оружие?',
                    'Правило масок на каптурах?',
                    'Стрельба с транспорта на капте?',
                    'Убийство с разрешения лидера?',
                    'Возврат на территорию захвата?',
                    'Использование транспорта в бою?',
                    'Когда начинать капт?',
                    'Время начала капта?',
                    'Кого прогонять с территории?',
                    'Что говорить нарушителям?',
                    'Нужны ли доказательства?',
                    'Действия с нарушителем внутри?',
                    'Предупреждение нарушителю?',
                    'Минимальный состав для рейда?',
                    'Помощь братку?',
                    'Действия при стрельбе братка?',
                    'Действия при погоне полиции?',
                    'Как называть оружие?',
                    'Действия при таране?',
                    'Подчинение другим организациям?',
                    'Состав для нападения на КПП?',
                    'Разрешена ли стрельба по братку?',
                    'Запрет стрельбы по братку?',
                    'Можно ли атаковать военных?',
                    'Ехать с братком против военных?',
                    'Когда атаковать военных?',
                    'Использование военной техники?',
                    'Действия против военных?'
                ]
            },
            'Правила ограбления и угона транспорта': {
                fields: ['AP', 'AQ', 'AR', 'AS', 'AT', 'AU', 'AV', 'AW', 'AX', 'AY', 'AZ', 'BA', 'BB', 'BC'],
                labels: [
                    'Правило 1',
                    'Правило 2',
                    'Правило 3',
                    'Правило 4',
                    'Правило 5',
                    'Правило 6',
                    'Правило 7',
                    'Правило 8',
                    'Правило 9',
                    'Правило 10',
                    'Правило 11',
                    'Правило 12',
                    'Правило 13',
                    'Правило 14'
                ]
            },
            'Экзамен среднего состава': {
                fields: ['BD', 'BE', 'BF', 'BG', 'BH', 'BI', 'BJ', 'BK', 'BL', 'BM', 'BN', 'BO', 'BP', 'BQ', 'BR', 'BS', 'BT', 'BU'],
                labels: [
                    'Требования для приема',
                    'Необходимые документы',
                    'Вопросы при собеседовании',
                    'Основные термины',
                    'Сценарий с гильзой',
                    'Проверка времени в организации',
                    'Причина отказа',
                    'Недочеты кандидата',
                    'Сообщение при принятии',
                    'Сообщение при отказе',
                    'С какого ранга принимать',
                    'Можно ли принимать на территории',
                    'Где можно принимать',
                    'Проверочные вопросы',
                    'Шаблон проверки законов',
                    'Действия при ошибках кандидата',
                    'Что проверять',
                    'Дополнительные требования'
                ]
            }
        };

        function showLoading() {
            const content = document.getElementById('content');
            content.innerHTML = `
                <div class="loading-container">
                    <div class="spinner"></div>
                    <p>Загрузка данных...</p>
                </div>
            `;
        }

        function showError(message) {
            const content = document.getElementById('content');
            content.innerHTML = `
                <div class="error-container">
                    <h2>⚠️ Ошибка загрузки данных</h2>
                    <p>${message}</p>
                    <button class="retry-btn" onclick="loadData()">Попробовать снова</button>
                </div>
            `;
            document.getElementById('stats').textContent = 'Ошибка';
        }

        function normalizeData(data) {
            
            if (data.data && Array.isArray(data.data)) {
                return data.data;
            }
            
            if (data.values && Array.isArray(data.values)) {
                const values = data.values;
                if (values.length === 0) return [];
                
                const headers = values[0];
                const rows = values.slice(1);
                
                return rows.map(row => {
                    const obj = {};
                    headers.forEach((header, index) => {
                        obj[header] = row[index] || '';
                    });
                    return obj;
                });
            }
            
            if (Array.isArray(data) && data.length > 0 && Array.isArray(data[0])) {
                const headers = data[0];
                const rows = data.slice(1);
                
                return rows.map(row => {
                    const obj = {};
                    headers.forEach((header, index) => {
                        obj[header] = row[index] || '';
                    });
                    return obj;
                });
            }
            
            if (Array.isArray(data)) {
                return data;
            }
            
            return [];
        }

        const PASSING_SCORES = {
            'Вступительный экзамен Плэйя': 22,
            'Правила ограбления и угона транспорта': 9,
            'Экзамен среднего состава': 0
        };

        function isPassed(score, examType) {
            if (typeof score !== 'number' && typeof score !== 'string') {
                return null;
            }
            
            const numScore = typeof score === 'string' ? parseFloat(score) : score;
            if (isNaN(numScore)) {
                return null;
            }
            
            const passingScore = PASSING_SCORES[examType];
            if (passingScore === undefined) {
                return numScore >= 10;
            }
            
            return numScore >= passingScore;
        }

        function formatValue(value) {
            if (value === null || value === undefined || value === '') {
                return '—';
            }
            
            const dateRegex = /^\d{4}-\d{2}-\d{2}|\d{2}\.\d{2}\.\d{4}|\d{2}\/\d{2}\/\d{4}$/;
            if (typeof value === 'string' && dateRegex.test(value)) {
                try {
                    const date = new Date(value);
                    if (!isNaN(date.getTime())) {
                        return date.toLocaleDateString('ru-RU', { 
                            year: 'numeric', 
                            month: 'long', 
                            day: 'numeric' 
                        });
                    }
                } catch (e) {
                    return value;
                }
            }
            
            if (!isNaN(value) && value !== '' && typeof value !== 'boolean') {
                const num = parseFloat(value);
                if (num > 999) {
                    return num.toLocaleString('ru-RU');
                }
            }
            
            return value;
        }

        let currentModalData = null;

        function createCard(item, index) {
            const card = document.createElement('div');
            card.className = 'card';
            card.dataset.index = index;
            
            const date = item.A ? new Date(item.A) : null;
            const name = item.B || 'Неизвестно';
            const examType = item.C || 'Неизвестно';
            const scoreValue = item.D || 0;
            const score = typeof scoreValue === 'string' ? parseFloat(scoreValue) : scoreValue;
            const contact = item.E || 'Не указан';
            
            const dateStr = date ? date.toLocaleDateString('ru-RU', { day: 'numeric', month: 'long', year: 'numeric' }) : 'Не указана';
            const timeStr = date ? date.toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' }) : '';
            
            const passed = isPassed(score, examType);
            const passingScore = PASSING_SCORES[examType] || 10;
            
            if (passed === true) {
                card.classList.add('passed');
            } else if (passed === false) {
                card.classList.add('failed');
            }
            
            let resultBadge = '';
            if (passed !== null) {
                resultBadge = passed ? 
                    `<span class="result-badge pass">✓ Сдал (${score}/${passingScore})</span>` : 
                    `<span class="result-badge fail">✗ Не сдал (${score}/${passingScore})</span>`;
            }
            
            let cardHTML = `
                <div class="card-header">
                    <span class="exam-type-badge">${examType}</span>
                    <div class="card-title">
                        <span>${name}</span>
                    </div>
                    <div class="card-subtitle">${dateStr} в ${timeStr}</div>
                </div>
                <div class="card-body">
                    <div class="card-field">
                        <span class="field-label">Результат:</span>
                        <span class="field-value">${resultBadge}</span>
                    </div>
                    <div class="card-field">
                        <span class="field-label">Балл:</span>
                        <span class="field-value"><strong>${score} баллов</strong></span>
                    </div>
                    <div class="card-field">
                        <span class="field-label">Контакт:</span>
                        <span class="field-value">${contact}</span>
                    </div>
                </div>
            `;
            
            card.innerHTML = cardHTML;
            
            card.addEventListener('click', function() {
                openModal(item, dateStr, timeStr, examType, name, score, contact, passed, passingScore);
            });
            
            return card;
        }

        function openModal(item, dateStr, timeStr, examType, name, score, contact, passed, passingScore) {
            const modal = document.getElementById('examModal');
            const modalTitle = document.getElementById('modalTitle');
            const modalSubtitle = document.getElementById('modalSubtitle');
            const modalDate = document.getElementById('modalDate');
            const modalScore = document.getElementById('modalScore');
            const modalContact = document.getElementById('modalContact');
            const modalAnswers = document.getElementById('modalAnswers');
            
            const statusEmoji = passed ? '✅' : '❌';
            const statusText = passed ? 'Сдал' : 'Не сдал';
            modalTitle.innerHTML = `${statusEmoji} ${name}`;
            modalSubtitle.innerHTML = `<span class="exam-type-badge">${examType}</span>`;
            
            modalDate.textContent = `${dateStr} в ${timeStr}`;
            modalScore.innerHTML = `<strong>${score}/${passingScore}</strong> баллов`;
            modalContact.textContent = contact;
            
            modalAnswers.innerHTML = generateAnswers(item, examType);
            
            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeModal() {
            const modal = document.getElementById('examModal');
            modal.classList.remove('active');
            document.body.style.overflow = '';
        }
        
        function generateAnswers(item, examType) {
            const mapping = EXAM_QUESTIONS[examType];
            if (!mapping) {
                return '<p style="color: #999;">Ответы не найдены для данного типа экзамена</p>';
            }
            
            let answersHTML = '';
            mapping.fields.forEach((field, idx) => {
                const answer = item[field];
                if (answer) {
                    answersHTML += `
                        <div class="answer-item">
                            <div class="answer-label">Вопрос ${idx + 1}: ${mapping.labels[idx]}</div>
                            <div class="answer-value">${answer}</div>
                        </div>
                    `;
                }
            });
            
            if (!answersHTML) {
                return '<p style="color: #999;">Ответы отсутствуют</p>';
            }
            
            return answersHTML;
        }

        function displayData(data) {
            const content = document.getElementById('content');
            
            if (!data || data.length === 0) {
                content.innerHTML = '<div class="no-data">📭 Нет данных для отображения</div>';
                return;
            }
            
            const groupedByMonth = {};
            data.forEach(item => {
                const date = item.A ? new Date(item.A) : null;
                if (date) {
                    const monthKey = date.toLocaleDateString('ru-RU', { year: 'numeric', month: 'long' });
                    if (!groupedByMonth[monthKey]) {
                        groupedByMonth[monthKey] = [];
                    }
                    groupedByMonth[monthKey].push(item);
                }
            });
            
            content.innerHTML = '';
            
            const sortedMonths = Object.keys(groupedByMonth).sort((a, b) => {
                const dateA = new Date(groupedByMonth[a][0].A);
                const dateB = new Date(groupedByMonth[b][0].A);
                return dateB - dateA;
            });
            
            sortedMonths.forEach(month => {
                const monthDivider = document.createElement('div');
                monthDivider.className = 'month-divider';
                monthDivider.textContent = month;
                content.appendChild(monthDivider);
                
                const grid = document.createElement('div');
                grid.className = 'cards-grid';
                
                groupedByMonth[month].forEach((item, index) => {
                    const card = createCard(item, index);
                    grid.appendChild(card);
                });
                
                content.appendChild(grid);
            });
        }

        function calculateStatistics(data) {
            const total = data.length;
            let passed = 0;
            let failed = 0;
            
            const byExamType = {};
            
            data.forEach(item => {
                const scoreValue = item.D || 0;
                const score = typeof scoreValue === 'string' ? parseFloat(scoreValue) : scoreValue;
                const examType = item.C || 'Неизвестно';
                const result = isPassed(score, examType);
                
                if (result === true) passed++;
                else if (result === false) failed++;
                
                if (!byExamType[examType]) {
                    byExamType[examType] = { total: 0, passed: 0, failed: 0 };
                }
                byExamType[examType].total++;
                if (result === true) byExamType[examType].passed++;
                else if (result === false) byExamType[examType].failed++;
            });
            
            return { total, passed, failed, byExamType };
        }
        
        function displayStatistics(data) {
            const stats = calculateStatistics(data);
            const container = document.getElementById('statisticsContainer');
            container.style.display = 'grid';
            
            const passPercentage = stats.total > 0 ? Math.round((stats.passed / stats.total) * 100) : 0;
            const failPercentage = stats.total > 0 ? Math.round((stats.failed / stats.total) * 100) : 0;
            
            container.innerHTML = `
                <div class="stat-card" style="animation-delay: 0.1s;">
                    <div class="stat-number primary">${stats.total}</div>
                    <div class="stat-label">📊 Всего экзаменов</div>
                </div>
                
                <div class="stat-card" style="animation-delay: 0.2s;">
                    <div class="stat-number success">${stats.passed}</div>
                    <div class="stat-label">✅ Успешно сдали</div>
                    <div style="font-size: 0.9rem; color: var(--success); margin-top: 4px; font-weight: 700;">${passPercentage}%</div>
                </div>
                
                <div class="stat-card" style="animation-delay: 0.3s;">
                    <div class="stat-number danger">${stats.failed}</div>
                    <div class="stat-label">❌ Не сдали</div>
                    <div style="font-size: 0.9rem; color: var(--error); margin-top: 4px; font-weight: 700;">${failPercentage}%</div>
                </div>
                
                <div class="stat-card" style="animation-delay: 0.4s;">
                    <div class="stat-label" style="margin-bottom: 8px;">🎯 Процент успеха</div>
                    <div class="progress-percentage">${passPercentage}%</div>
                    <div class="progress-bar-container">
                        <div class="progress-bar-wrapper">
                            <div class="progress-bar-fill" id="progressBarFill" style="width: 0%;"></div>
                        </div>
                    </div>
                </div>
            `;
            
            setTimeout(() => {
                const progressBar = document.getElementById('progressBarFill');
                if (progressBar) {
                    progressBar.style.width = passPercentage + '%';
                }
            }, 100);
        }
        
        function populateFilters(data) {
            const examTypes = new Set();
            const months = new Set();
            
            data.forEach(item => {
                if (item.C) examTypes.add(item.C);
                if (item.A) {
                    const date = new Date(item.A);
                    const monthKey = date.toLocaleDateString('ru-RU', { year: 'numeric', month: 'long' });
                    months.add(monthKey);
                }
            });
            
            const examTypeFilter = document.getElementById('examTypeFilter');
            examTypeFilter.innerHTML = '<option value="all">Все экзамены</option>';
            Array.from(examTypes).sort().forEach(type => {
                examTypeFilter.innerHTML += `<option value="${type}">${type}</option>`;
            });
            
            const monthFilter = document.getElementById('monthFilter');
            monthFilter.innerHTML = '<option value="all">Все месяцы</option>';
            Array.from(months).sort().reverse().forEach(month => {
                monthFilter.innerHTML += `<option value="${month}">${month}</option>`;
            });
            
            document.getElementById('filtersContainer').style.display = 'block';
        }
        
        function applyFilters() {
            const examType = document.getElementById('examTypeFilter').value;
            const month = document.getElementById('monthFilter').value;
            const status = document.getElementById('statusFilter').value;
            
            filteredData = allData.filter(item => {
                let matchExam = examType === 'all' || item.C === examType;
                let matchMonth = true;
                let matchStatus = true;
                
                if (month !== 'all' && item.A) {
                    const date = new Date(item.A);
                    const monthKey = date.toLocaleDateString('ru-RU', { year: 'numeric', month: 'long' });
                    matchMonth = monthKey === month;
                }
                
                if (status !== 'all') {
                    const scoreValue = item.D || 0;
                    const score = typeof scoreValue === 'string' ? parseFloat(scoreValue) : scoreValue;
                    const passed = isPassed(score, item.C);
                    
                    if (status === 'passed') {
                        matchStatus = passed === true;
                    } else if (status === 'failed') {
                        matchStatus = passed === false;
                    }
                }
                
                return matchExam && matchMonth && matchStatus;
            });
            
            displayData(filteredData);
            displayStatistics(filteredData);
        }
        
        async function loadData() {
            const refreshBtn = document.getElementById('refreshBtn');
            refreshBtn.classList.add('loading');
            refreshBtn.disabled = true;
            
            showLoading();
            
            try {
                const response = await fetch(API_URL);
                
                if (!response.ok) {
                    throw new Error(`HTTP ошибка! Статус: ${response.status}`);
                }
                
                const rawData = await response.json();
                const normalizedData = normalizeData(rawData);
                
                // Сортировка по дате (новые сверху)
                normalizedData.sort((a, b) => {
                    const dateA = a.A ? new Date(a.A) : new Date(0);
                    const dateB = b.A ? new Date(b.A) : new Date(0);
                    return dateB - dateA;
                });
                
                allData = normalizedData;
                filteredData = allData;
                
                populateFilters(allData);
                displayStatistics(allData);
                displayData(allData);
                
            } catch (error) {
                console.error('Ошибка загрузки данных:', error);
                showError(error.message || 'Не удалось загрузить данные. Проверьте подключение к интернету.');
            } finally {
                refreshBtn.classList.remove('loading');
                refreshBtn.disabled = false;
            }
        }

        window.addEventListener('DOMContentLoaded', () => {
            loadData();
            
            const modal = document.getElementById('examModal');
            const backdrop = document.querySelector('.modal-backdrop');
            const closeBtn = document.querySelector('.modal-close');
            
            backdrop.addEventListener('click', closeModal);
            closeBtn.addEventListener('click', closeModal);
            
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && modal.classList.contains('active')) {
                    closeModal();
                }
            });
        });

    </script>

    <div id="examModal" class="modal">
        <div class="modal-backdrop"></div>
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-close">×</div>
                <h2 class="modal-title" id="modalTitle"></h2>
                <div class="modal-subtitle" id="modalSubtitle"></div>
            </div>
            <div class="modal-body">
                <div class="modal-info-grid">
                    <div class="modal-info-item">
                        <div class="modal-info-label">📅 Дата экзамена</div>
                        <div class="modal-info-value" id="modalDate"></div>
                    </div>
                    <div class="modal-info-item">
                        <div class="modal-info-label">🎯 Балл</div>
                        <div class="modal-info-value" id="modalScore"></div>
                    </div>
                    <div class="modal-info-item">
                        <div class="modal-info-label">📱 Контакт</div>
                        <div class="modal-info-value" id="modalContact"></div>
                    </div>
                </div>
                <div class="answers-section">
                    <div class="answers-title">📝 Ответы на вопросы</div>
                    <div id="modalAnswers">
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
